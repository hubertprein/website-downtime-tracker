<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Website Downtime Tracker</title>
  <meta name="description" content="Simple offline-first tracker for downtime incidents. Save to your browser, export/import JSON for backup." />
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#121821;
      --panel-2:#0f141c;
      --text:#e8eef6;
      --muted:#9fb2c7;
      --accent:#6ee7b7;
      --accent-2:#60a5fa;
      --danger:#f87171;
      --warn:#fbbf24;
      --success:#34d399;
      --border:#223041;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% -10%, #152033 0%, #0b0f14 40%, #0b0f14 100%);
      color:var(--text);
    }
    header{position:sticky; top:0; z-index:2; backdrop-filter: blur(8px); background: linear-gradient(180deg, rgba(11,15,20,.9), rgba(11,15,20,.6)); border-bottom:1px solid var(--border);}
    .wrap{max-width:1100px; margin:0 auto; padding:20px}
    .title{display:flex; align-items:center; gap:14px}
    h1{margin:0; font-size: clamp(20px, 2.6vw, 32px)}
    .badge{font-size:12px; padding:4px 8px; border:1px solid var(--border); border-radius:999px; color:var(--muted)}
    .controls{display:flex; flex-wrap:wrap; gap:10px; margin-top:14px}
    button, input, select, textarea{background: var(--panel); color: var(--text); border:1px solid var(--border); border-radius:12px; padding:10px 12px; font-size:14px;}
    button{cursor:pointer}
    button.primary{background: linear-gradient(180deg, #1e293b, #0f172a); border-color:#1f2a3a}
    button.accent{background: linear-gradient(180deg, #133024, #0f271d); border-color:#1f3b2c}
    button:hover{filter:brightness(1.06)}
    button:active{transform: translateY(1px)}
    main{display:grid; grid-template-columns: 1.2fr .8fr; gap:20px; padding:20px}
    @media (max-width: 920px){ main{grid-template-columns: 1fr} }
    .card{background: linear-gradient(180deg, var(--panel), var(--panel-2)); border:1px solid var(--border); box-shadow: var(--shadow); border-radius: var(--radius);}
    .card .head{padding:16px 16px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between}
    .card .body{padding:16px}
    .muted{color:var(--muted)}
    .grid{display:grid; grid-template-columns: repeat(6,1fr); gap:10px}
    .grid .full{grid-column: 1/-1}
    .grid label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
    .table{width:100%; border-collapse: collapse}
    .table th, .table td{ padding:10px 8px; border-bottom:1px solid var(--border); text-align:left; vertical-align: top }
    .table th{font-size:12px; color:var(--muted); font-weight:600}
    .pill{padding:.2rem .6rem; border-radius:999px; border:1px solid var(--border); background:#0c131d; font-size:12px}
    .pill.warn{border-color:#6b4f16; background:#1a1306; color:#ffd37a}
    .pill.danger{border-color:#6b1f1f; background:#1a0b0b; color:#ffb4b4}
    .pill.ok{border-color:#175e3a; background:#0b1a12; color:#9ff2cd}
    .flex{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .right{margin-left:auto}
    .stat-grid{display:grid; grid-template-columns: repeat(4, 1fr); gap:12px}
    @media (max-width: 620px){ .stat-grid{grid-template-columns: repeat(2, 1fr)} }
    .stat{padding:14px; border-radius:14px; background: linear-gradient(180deg, #0e1520, #0d1117); border:1px solid var(--border)}
    .stat .label{font-size:12px; color:var(--muted)}
    .stat .value{font-size:22px; font-weight:700; margin-top:6px}
    .footer{padding:20px; text-align:center; color:var(--muted)}
    .link{color:var(--accent-2); text-decoration:none}
    .link:hover{text-decoration:underline}
    .search{display:flex; gap:8px; flex-wrap:wrap}
    .search input{flex:1}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="title">
      <h1>Website Downtime Tracker</h1>
      <span class="badge">Offline-first • GitHub Pages</span>
    </div>
    <div class="controls">
      <button id="addSample">Add sample data</button>
      <button id="exportBtn" class="accent">Export JSON</button>
      <input type="file" id="importFile" accept="application/json" style="display:none"/>
      <button id="importBtn">Import JSON</button>
      <button id="clearBtn">Clear all</button>
      <span class="muted">Data is saved to your browser (localStorage).</span>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="card" style="grid-column: 1/-1">
    <div class="head"><strong>Add / Edit Incident</strong></div>
    <div class="body">
      <form id="incidentForm">
        <input type="hidden" id="rowId"/>
        <div class="grid">
          <div style="grid-column: span 2"><label for="date">Date</label><input type="date" id="date" required /></div>
          <div style="grid-column: span 2"><label for="duration">Total time (minutes)</label><input type="number" id="duration" min="0" step="1" required /></div>
          <div style="grid-column: span 2"><label for="revenue">Loss of revenue (€)</label><input type="number" id="revenue" min="0" step="0.01" /></div>
          <div class="full"><label for="learnings">Learnings / Root cause / Notes</label><textarea id="learnings" rows="3"></textarea></div>
          <div class="full flex" style="justify-content:flex-end; gap:10px"><button type="button" id="resetBtn">Reset</button><button type="submit" class="primary">Save Incident</button></div>
        </div>
      </form>
    </div>
  </section>

  <section class="card">
    <div class="head"><strong>Incidents</strong></div>
    <div class="body">
      <table class="table" id="table"><thead><tr><th>Date</th><th>Duration</th><th>Revenue loss (€)</th><th>Learnings</th><th>Actions</th></tr></thead><tbody id="tbody"></tbody></table>
      <div id="empty" class="muted" style="padding:8px 2px; display:none">No incidents yet.</div>
    </div>
  </section>

  <section class="card">
    <div class="head"><strong>Metrics</strong></div>
    <div class="body">
      <div class="stat-grid">
        <div class="stat"><div class="label">Total incidents</div><div class="value" id="statIncidents">0</div></div>
        <div class="stat"><div class="label">Total downtime</div><div class="value" id="statDowntime">0m</div></div>
        <div class="stat"><div class="label">MTTR</div><div class="value" id="statMTTR">–</div></div>
        <div class="stat"><div class="label">Total revenue loss</div><div class="value" id="statRevenue">€0.00</div></div>
      </div>
    </div>
  </section>
</main>

<script>
(function(){
  const LS_KEY = 'downtimeLog_v1';
  const currency = new Intl.NumberFormat(undefined, { style:'currency', currency: 'EUR' });

  let data = load();
  const tbody = document.getElementById('tbody');
  const form = document.getElementById('incidentForm');
  const rowId = document.getElementById('rowId');
  const dateEl = document.getElementById('date');
  const durationEl = document.getElementById('duration');
  const revenueEl = document.getElementById('revenue');
  const learningsEl = document.getElementById('learnings');
  const statIncidents = document.getElementById('statIncidents');
  const statDowntime = document.getElementById('statDowntime');
  const statMTTR = document.getElementById('statMTTR');
  const statRevenue = document.getElementById('statRevenue');

  function save(){ localStorage.setItem(LS_KEY, JSON.stringify(data)); }
  function load(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)||'{"entries":[]}'); }catch(e){ return {entries:[]} } }
  function uid(){ return Math.random().toString(36).slice(2,10); }
  function fmtDate(iso){ return new Intl.DateTimeFormat(undefined,{year:'numeric',month:'short',day:'2-digit'}).format(new Date(iso)); }
  function fmtDuration(min){ const h=Math.floor(min/60), m=min%60; return (h? h+'h ':'')+m+'m'; }
  function fmtMoney(n){ return currency.format(Number(n||0)); }

  function render(){
    tbody.innerHTML='';
    if(data.entries.length===0){ document.getElementById('empty').style.display='block'; return; }
    document.getElementById('empty').style.display='none';
    data.entries.forEach(e=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${fmtDate(e.date)}</td><td>${fmtDuration(e.duration)}</td><td>${fmtMoney(e.revenue)}</td><td>${e.learnings}</td><td><button data-id="${e.id}" class="del">Delete</button></td>`;
      tbody.appendChild(tr);
    });
    updateStats();
  }

  function updateStats(){
    const count=data.entries.length;
    const totalMin=data.entries.reduce((a,b)=>a+(+b.duration||0),0);
    const totalRev=data.entries.reduce((a,b)=>a+(+b.revenue||0),0);
    statIncidents.textContent=count;
    statDowntime.textContent=fmtDuration(totalMin);
    statMTTR.textContent=count?fmtDuration(Math.round(totalMin/count)):'–';
    statRevenue.textContent=fmtMoney(totalRev);
  }

  form.addEventListener('submit',ev=>{
    ev.preventDefault();
    const entry={id:rowId.value||uid(), date:dateEl.value, duration:+durationEl.value, revenue:+revenueEl.value, learnings:learningsEl.value};
    const idx=data.entries.findIndex(e=>e.id===entry.id);
    if(idx>-1) data.entries[idx]=entry; else data.entries.push(entry);
    save(); render(); form.reset();
  });

  tbody.addEventListener('click',e=>{
    if(e.target.classList.contains('del')){
      const id=e.target.dataset.id;
      data.entries=data.entries.filter(x=>x.id!==id);
      save(); render();
    }
  });

  document.getElementById('exportBtn').addEventListener('click',()=>{
    const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='downtime-log.json'; a.click(); URL.revokeObjectURL(a.href);
  });

  document.getElementById('importBtn').addEventListener('click',()=>document.getElementById('importFile').click());
  document.getElementById('importFile').addEventListener('change',async ev=>{
    const file=ev.target.files[0]; if(!file) return;
    try{const json=JSON.parse(await file.text()); data=json; save(); render();}catch(e){alert('Import failed');}
  });
  document.getElementById('clearBtn').addEventListener('click',()=>{if(confirm('Clear all?')){data={entries:[]}; save(); render();}});
  document.getElementById('addSample').addEventListener('click',()=>{
    data.entries.push({id:uid(),date:new Date().toISOString().slice(0,10),duration:45,revenue:500,learnings:'Example downtime'});
    save(); render();
  });

  render();
})();
</script>
</body>
</html>
